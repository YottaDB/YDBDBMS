load test_helpers

setup() {
  init_test
  createdb
  load_fixture names.sql
  load_fixture names.zwr
}

@test "inner join with simple ON condition" {
  octo >& output.txt <<OCTO
select * from names as t1 inner join names as t2
on (t1.id = t2.id);
OCTO
  run cat output.txt
  [[ "$output" =~ "0|Zero|Cool|0|Zero|Cool" ]]
  ! [[ "$output" =~ "0|Zero|Cool|1|Acid|Burn" ]]
}

@test "inner join with a table against itself with no ON condition" {
  octo <<OCTO &> output.txt
CREATE TABLE Orders (OrderID INTEGER PRIMARY KEY, CustomerID INTEGER, EmployeeID INTEGER, OrderDate VARCHAR(16), ShipperID INTEGER);
select o.ShipperID from Orders
inner join Orders o
where Orders.EmployeeID = o.ShipperID and o.ShipperID = 3;
OCTO
  # no crash is a success for this test
}

@test "inner join with a table against itself with no alias on one of the names" {
  octo <<OCTO &> output.txt
CREATE TABLE Orders (OrderID INTEGER PRIMARY KEY, CustomerID INTEGER, EmployeeID INTEGER, OrderDate VARCHAR(16), ShipperID INTEGER);
select o.ShipperID from Orders
inner join Orders o
on Orders.EmployeeID = o.ShipperID where o.ShipperID = 3;
OCTO
  # no crash is a success for this test
}
